#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged
echo "ğŸ“ Running lint-staged..."
npx lint-staged --concurrent false

# Check for package.json changes
if git diff --cached --name-only | grep -q "package.json"; then
  echo "ğŸ“¦ package.json changed, running additional checks..."
  npm audit --audit-level moderate
fi

# Check for lockfile changes
if git diff --cached --name-only | grep -E "(package-lock\.json|pnpm-lock\.yaml|yarn\.lock)"; then
  echo "ğŸ”’ Lockfile changed, running dependency check..."
  npm ci
fi

# Run type check
echo "ğŸ”· Running type check..."
turbo run check-types

# Run unit tests
echo "ğŸ§ª Running unit tests..."
turbo run test:unit -- --run

echo "âœ… All pre-commit checks passed!"
